# JRDBデータをFirestoreに保存する場合の費用見積もり

## Firestoreの料金体系（2024年現在）

### 基本料金
- **ストレージ容量**: 1 GiBまで無料、超過分は **$0.115/GiB/月**
- **ドキュメント読み取り**: 1日50,000回まで無料、超過分は **$0.038/10万回**
- **ドキュメント書き込み**: 1日20,000回まで無料、超過分は **$0.115/10万回**
- **ドキュメント削除**: 1日20,000回まで無料、超過分は **$0.113/10万回**
- **ネットワーク転送（下り）**: 月10 GiBまで無料、超過分は **$0.14～$0.19/GiB**（リージョンによる）

**注意**: GiB（ギビバイト）= 1,024^3 バイト、GB（ギガバイト）= 1,000^3 バイト

## JRDBデータの規模推定

### データタイプ別の規模見積もり（10年間分）

#### 1. レース・競走馬データ（メインデータ）

| データタイプ | データID | 1日あたりの件数 | 年間件数 | 10年間件数 | 1ドキュメントあたりのサイズ | 総ストレージ |
|---|---|---|---|---|---|---|
| 番組データ | BAC/BAB | 10レース/日 | 2,600レース/年 | 26,000レース | 約2KB | 約52MB |
| 競走馬データ | KYI/KYH/KYG | 120頭/日（10レース×12頭） | 31,200頭/年 | 312,000頭 | 約3KB | 約936MB |
| 馬基本データ | UKC | 新規登録: 約3,000頭/年 | 30,000頭（累積） | 30,000頭 | 約1KB | 約30MB |
| 前走データ | ZED/ZEC | 120頭/日 | 31,200頭/年 | 312,000頭 | 約5KB（過去5走分） | 約1,560MB |
| 前走拡張データ | ZKB | 120頭/日 | 31,200頭/年 | 312,000頭 | 約2KB | 約624MB |
| 情報データ | JOA | 120頭/日 | 31,200頭/年 | 312,000頭 | 約2KB | 約624MB |
| 競走馬拡張データ | KKA | 120頭/日 | 31,200頭/年 | 312,000頭 | 約1KB | 約312MB |
| 調教分析データ | CYB/CYA | 120頭/日 | 31,200頭/年 | 312,000頭 | 約1.5KB | 約468MB |
| 調教本追切データ | CHA | 120頭/日 | 31,200頭/年 | 312,000頭 | 約1KB | 約312MB |
| 直前情報データ | TYB | 120頭/日 | 31,200頭/年 | 312,000頭 | 約2KB | 約624MB |

**小計（競走馬・レース関連）**: 約5.5GB

#### 2. オッズデータ

| データタイプ | データID | 1日あたりの件数 | 年間件数 | 10年間件数 | 1ドキュメントあたりのサイズ | 総ストレージ |
|---|---|---|---|---|---|---|
| 基準オッズデータ | OZ | 10レース/日 | 2,600レース/年 | 26,000レース | 約1KB | 約26MB |
| ワイド基準オッズ | OW | 10レース/日 | 2,600レース/年 | 26,000レース | 約0.5KB | 約13MB |
| 馬単基準オッズ | OU | 10レース/日 | 2,600レース/年 | 26,000レース | 約0.5KB | 約13MB |
| 3連複基準オッズ | OT | 10レース/日 | 2,600レース/年 | 26,000レース | 約0.5KB | 約13MB |
| 3連単基準オッズ | OV | 10レース/日 | 2,600レース/年 | 26,000レース | 約0.5KB | 約13MB |

**小計（オッズデータ）**: 約78MB

#### 3. 成績データ

| データタイプ | データID | 1日あたりの件数 | 年間件数 | 10年間件数 | 1ドキュメントあたりのサイズ | 総ストレージ |
|---|---|---|---|---|---|---|
| 成績データ | SED/SEC | 120頭/日 | 31,200頭/年 | 312,000頭 | 約3KB | 約936MB |
| 成績レースデータ | SRB/SRA | 10レース/日 | 2,600レース/年 | 26,000レース | 約1KB | 約26MB |
| 成績拡張データ | SKB | 120頭/日 | 31,200頭/年 | 312,000頭 | 約1KB | 約312MB |
| 払戻情報データ | HJC/HJA | 10レース/日 | 2,600レース/年 | 26,000レース | 約1KB | 約26MB |

**小計（成績データ）**: 約1.3GB

#### 4. マスタデータ

| データタイプ | データID | 累積件数 | 1ドキュメントあたりのサイズ | 総ストレージ |
|---|---|---|---|---|
| 騎手マスタ | KZA/KSA | 約500騎手（累積） | 約1KB | 約0.5MB |
| 調教師マスタ | CZA/CSA | 約300調教師（累積） | 約1KB | 約0.3MB |

**小計（マスタデータ）**: 約0.8MB

### 総ストレージ容量の推定

| カテゴリ | 総ストレージ |
|---|---|
| 競走馬・レース関連データ | 約5.5GB |
| オッズデータ | 約78MB |
| 成績データ | 約1.3GB |
| マスタデータ | 約0.8MB |
| **合計** | **約6.9GB** |

**注意**: 
- 実際のデータサイズは、JSON形式での保存、インデックス、メタデータを含むため、上記より大きくなる可能性があります
- 安全マージンを考慮して、**実際は約10GB程度**と見積もることを推奨します

## Firestore保存費用の見積もり

### シナリオ1: 基本保存のみ（最小限の読み取り・書き込み）

#### ストレージ費用
- 無料枠: 1 GiB
- 超過分: 10 GB - 1 GiB = 約9.3 GiB
- **ストレージ費用**: 9.3 GiB × $0.115/GiB = **$1.07/月**

#### 書き込み費用（初期データ投入）
- 総ドキュメント数: 約150万ドキュメント（10年間分）
- バッチ書き込み: 500件/回 = 約3,000回の書き込み操作
- 無料枠: 20,000回/日
- **書き込み費用**: $0（無料枠内）

#### 読み取り費用（月間アクセス想定）
- 1日あたりの読み取り: 1,000回（レース検索、馬情報取得など）
- 月間読み取り: 1,000回 × 30日 = 30,000回
- 無料枠: 50,000回/日 × 30日 = 1,500,000回/月
- **読み取り費用**: $0（無料枠内）

#### ネットワーク転送費用
- 月間転送量: 約500MB（軽度の利用想定）
- 無料枠: 10 GiB/月
- **ネットワーク転送費用**: $0（無料枠内）

**シナリオ1の合計費用**: **約$1.07/月**

### シナリオ2: 中程度の利用（モデル学習・分析）

#### ストレージ費用
- ストレージ容量: 10 GB
- **ストレージ費用**: **$1.07/月**（シナリオ1と同じ）

#### 書き込み費用（データ更新）
- 1日あたりの書き込み: 500件（新規データ追加）
- 月間書き込み: 500件 × 30日 = 15,000回
- 無料枠: 20,000回/日
- **書き込み費用**: $0（無料枠内）

#### 読み取り費用（モデル学習・分析）
- 1日あたりの読み取り: 10,000回（モデル学習時のデータ取得）
- 月間読み取り: 10,000回 × 30日 = 300,000回
- 無料枠: 50,000回/日 × 30日 = 1,500,000回/月
- **読み取り費用**: $0（無料枠内）

#### ネットワーク転送費用
- 月間転送量: 約5GB（モデル学習時のデータ転送）
- 無料枠: 10 GiB/月
- **ネットワーク転送費用**: $0（無料枠内）

**シナリオ2の合計費用**: **約$1.07/月**

### シナリオ3: 大規模な利用（頻繁なデータ取得・分析）

#### ストレージ費用
- ストレージ容量: 10 GB
- **ストレージ費用**: **$1.07/月**

#### 書き込み費用
- 1日あたりの書き込み: 5,000件（頻繁なデータ更新）
- 月間書き込み: 5,000件 × 30日 = 150,000回
- 無料枠: 20,000回/日 × 30日 = 600,000回/月
- **書き込み費用**: $0（無料枠内）

#### 読み取り費用
- 1日あたりの読み取り: 100,000回（大規模な分析・予測処理）
- 月間読み取り: 100,000回 × 30日 = 3,000,000回
- 無料枠: 50,000回/日 × 30日 = 1,500,000回/月
- 超過分: 3,000,000回 - 1,500,000回 = 1,500,000回
- **読み取り費用**: 1,500,000回 × $0.038/100,000回 = **$0.57/月**

#### ネットワーク転送費用
- 月間転送量: 約50GB（大量のデータ転送）
- 無料枠: 10 GiB/月
- 超過分: 50GB - 10GB = 40GB
- **ネットワーク転送費用**: 40GB × $0.14/GB = **$5.60/月**

**シナリオ3の合計費用**: **約$7.24/月**

## 費用比較: Firestore vs Firebase Storage

| 項目 | Firestore | Firebase Storage |
|---|---|---|
| **ストレージ容量（10GB）** | $1.07/月 | $0.26/月 |
| **データアクセス** | 読み取り回数で課金 | ダウンロード量で課金 |
| **クエリ機能** | 高度なクエリ可能 | ファイルアクセスのみ |
| **リアルタイム更新** | サポート | サポートなし |
| **データ構造** | ドキュメント形式（JSON） | ファイル形式（Parquet等） |
| **推奨用途** | リアルタイムアクセス、クエリが必要な場合 | バッチ処理、モデル学習用 |

## 推奨されるデータ保存戦略

### ハイブリッドアプローチ（推奨）

1. **Firebase Storage**: 大容量データの保存（Parquet形式）
   - 10年間のデータ: 約100GB
   - 月額費用: 約$2.47（ストレージ）
   - **用途**: モデル学習、バッチ分析、データアーカイブ

2. **Firestore**: アクティブなデータの保存（JSON形式）
   - 最新1年分のデータ: 約1GB
   - 月額費用: ほぼ無料（無料枠内）
   - **用途**: リアルタイムアクセス、クエリ、予想実行時のデータ取得

### コスト最適化のポイント

1. **データのライフサイクル管理**
   - 古いデータはFirebase Storageにアーカイブ
   - アクティブなデータのみFirestoreに保持

2. **読み取り回数の最適化**
   - バッチ処理でデータを取得（1回の読み取りで複数ドキュメント取得）
   - キャッシュを活用して読み取り回数を削減

3. **ネットワーク転送の最適化**
   - 必要なデータのみ取得
   - データ圧縮を検討

## 総合的な費用見積もり

### 最小構成（Firebase Storageのみ）
- **月額**: 約$2.47（ストレージ 10GB）
- **用途**: データアーカイブ、モデル学習

### 標準構成（Firebase Storage + Firestore）
- **Firebase Storage**: 約$2.47/月（10GB）
- **Firestore**: 約$1.07/月（1GB、軽度のアクセス）
- **合計**: 約$3.54/月

### 大規模構成（Firebase Storage + Firestore（大規模利用））
- **Firebase Storage**: 約$2.47/月（10GB）
- **Firestore**: 約$7.24/月（10GB、大規模アクセス）
- **合計**: 約$9.71/月

## 注意事項

1. **データサイズの変動**: 実際のデータサイズは、データ構造やフィールドの内容によって変動します
2. **アクセスパターン**: 読み取り・書き込みの頻度は利用パターンによって大きく異なります
3. **リージョン**: ネットワーク転送費用はリージョンによって異なります（東京リージョン: $0.14/GB）
4. **インデックス**: Firestoreの複合インデックスは追加のストレージを消費します
5. **無料枠**: 1年間の無料トライアル期間中は、上記の無料枠が拡張される場合があります

## 参考リンク

- [Firestore料金](https://firebase.google.com/pricing?hl=ja)
- [Firebase Storage料金](https://firebase.google.com/pricing?hl=ja)
- [Google Cloud料金計算ツール](https://cloud.google.com/products/calculator)

