# オッズデータの過去履歴取得方法の分析

## 問題

オッズデータ（OZ, OW, OU, OT, OV）には**年度パックが提供されていない**ため、過去のオッズ履歴を一括取得できない可能性があります。

## 確認事項

### 1. 年度パックの有無

- **OZ, OW, OU, OT, OV**: すべて`hasAnnualPack: false`
- 年度パック形式（例: `OZ_2024.lzh`）は提供されていない

### 2. 単体データでの取得可能性

メンバーページには「単体データコーナー」があり、日付別の単体データが提供されています。

- **URL形式**: `https://jrdb.com/member/data/Oz/index.html`（OZの場合）
- **ファイル形式**: `OZ251102.lzh`（日付別単体データ）
- **提供期間**: 「最新データを中心に提供」と記載されているが、過去データも一定期間は残っている可能性

**注意**: 単体データは最新データ中心のため、古いデータは削除される可能性があります。

### 3. 成績データ（SED/SEC）からの抽出

**重要な発見**: 成績データ（SED/SEC）には**オッズ情報が含まれています**。

#### SED/SECに含まれるオッズ関連フィールド

- `確定単勝オッズ` (175-180バイト)
- `確定単勝人気順位` (181-182バイト)
- `確定複勝オッズ下` (291-308バイト、3個)
- `単勝` (342-348バイト) - 払戻金
- `複勝` (349-355バイト) - 払戻金

#### 前走データ（ZED/ZEC）にも含まれる

- `確定単勝オッズ` (175-180バイト)
- `確定単勝人気順位` (181-182バイト)
- `確定複勝オッズ下` (291-308バイト、3個)
- `単勝` (342-348バイト) - 払戻金（ZEDのみ）
- `複勝` (349-355バイト) - 払戻金（ZEDのみ）

## 過去のオッズ履歴取得方法

### 方法1: 成績データ（SED/SEC）から抽出 ⭐推奨

**利点**:
- ✅ 年度パックがあるため、過去データの一括取得が容易
- ✅ オッズ情報が含まれている
- ✅ レース結果と一緒に取得できる

**取得できるオッズ情報**:
- 確定単勝オッズ
- 確定単勝人気順位
- 確定複勝オッズ（下限）
- 払戻金（単勝・複勝）

**制限**:
- 基準オッズデータ（OZ/OW/OU/OT/OV）の詳細なオッズ情報（馬連、ワイド、馬単、3連複、3連単など）は含まれていない
- 確定オッズ（レース確定後のオッズ）のみ

### 方法2: 単体データを日付単位で取得

**利点**:
- ✅ 基準オッズデータの詳細な情報が取得できる
- ✅ 馬連、ワイド、馬単、3連複、3連単などのオッズ情報が取得できる

**欠点**:
- ❌ 年度パックがないため、過去データの一括取得が困難
- ❌ 単体データは最新データ中心のため、古いデータは削除される可能性
- ❌ 日付単位で取得する必要があるため、大量のリクエストが必要

### 方法3: メンバーページから過去の単体データを確認

メンバーページの「単体データコーナー」に過去のデータがどのくらい残っているかを確認する必要があります。

**確認方法**:
1. `https://jrdb.com/member/data/Oz/index.html` にアクセス
2. 単体データコーナーに過去のデータがどのくらい残っているか確認
3. 過去データの保存期間を確認

## 推奨事項

### 過去のオッズ履歴が必要な場合

1. **基本オッズ情報（単勝・複勝）**: 成績データ（SED/SEC）から抽出
   - 年度パックがあるため、過去データの一括取得が容易
   - 確定オッズと払戻金が取得できる

2. **詳細オッズ情報（馬連・ワイド・馬単・3連複・3連単）**: 
   - 単体データを日付単位で取得する必要がある
   - ただし、古いデータは削除されている可能性が高い
   - 実用的には、**最新データのみ取得**する方針が現実的

### 実装方針

1. **予測に必要なオッズ情報**: 成績データ（SED/SEC）から抽出
   - 確定単勝オッズ、確定単勝人気順位、確定複勝オッズ
   - 年度パックがあるため、過去データも取得可能

2. **検証・分析用の詳細オッズ情報**: 
   - 最新データのみ単体データで取得
   - 過去データは取得が困難なため、今後は定期的に取得して保存する必要がある

## 結論

**過去のオッズ履歴を取得する方法**:

1. ✅ **基本オッズ情報**: 成績データ（SED/SEC）から抽出可能（年度パックあり）
2. ⚠️ **詳細オッズ情報**: 単体データで取得可能だが、古いデータは削除されている可能性が高い

**推奨**: 
- 予測に必要な基本オッズ情報は、成績データ（SED/SEC）から抽出
- 詳細オッズ情報は、今後は定期的に取得して保存する方針が現実的

