---
alwaysApply: true
---

# Memoca Firebase ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«

## ğŸ¯ åŸºæœ¬åŸå‰‡

### 1. ç°¡ç´ ãªå®Ÿè£…
- **1liner**: å¯èƒ½ãªé™ã‚Š1è¡Œã§è¨˜è¿°
- **ã‚¬ãƒ¼ãƒ‰å¥**: æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¹ãƒˆã‚’é¿ã‘ã‚‹
- **ç°¡æ½”æ€§**: å†—é•·ãªã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã‚‹

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦–
- **Security Rules**: é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
- **èªè¨¼**: é©åˆ‡ãªèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
- **æ¨©é™**: æœ€å°æ¨©é™ã®åŸå‰‡

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–
- **ã‚¯ã‚¨ãƒª**: åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªã®ä½œæˆ
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®š
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

## ğŸ“ Firebaseã®æ›¸ãæ–¹

### Firestoreã®æ›¸ãæ–¹

#### âŒ æ‚ªã„ä¾‹
```typescript
// ä¸é©åˆ‡ãªã‚¯ã‚¨ãƒª
async function getUsers() {
  try {
    const snapshot = await getDocs(collection(db, 'users'));
    const users = [];
    snapshot.forEach(doc => {
      const userData = doc.data();
      if (userData.isActive) {
        users.push({
          id: doc.id,
          ...userData
        });
      }
    });
    return users;
  } catch (error) {
    console.error('Error getting users:', error);
    return [];
  }
}

// ä¸é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°
async function updateUser(userId: string, data: any) {
  try {
    await updateDoc(doc(db, 'users', userId), data);
    return true;
  } catch (error) {
    console.error('Error updating user:', error);
    return false;
  }
}
```

#### âœ… è‰¯ã„ä¾‹
```typescript
// é©åˆ‡ãªã‚¯ã‚¨ãƒª
async function getActiveUsers(): Promise<User[]> {
  try {
    const q = query(
      collection(db, 'users'),
      where('isActive', '==', true)
    );
    const snapshot = await getDocs(q);
    return snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    } as User));
  } catch (error) {
    console.error('Error getting active users:', error);
    throw error;
  }
}

// é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°
async function updateUser(userId: string, data: Partial<User>): Promise<void> {
  if (!userId || !data) throw new Error('Invalid parameters');
  
  try {
    await updateDoc(doc(db, 'users', userId), data);
  } catch (error) {
    console.error('Error updating user:', error);
    throw error;
  }
}
```

### Authenticationã®æ›¸ãæ–¹

#### âŒ æ‚ªã„ä¾‹
```typescript
// ä¸é©åˆ‡ãªèªè¨¼å‡¦ç†
async function login(email: string, password: string) {
  try {
    const result = await signInWithEmailAndPassword(auth, email, password);
    const user = result.user;
    if (user) {
      const token = await user.getIdToken();
      localStorage.setItem('token', token);
      return user;
    }
  } catch (error) {
    console.error('Login error:', error);
    return null;
  }
}

// ä¸é©åˆ‡ãªèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
function checkAuth() {
  const user = auth.currentUser;
  if (user) {
    return true;
  } else {
    return false;
  }
}
```

#### âœ… è‰¯ã„ä¾‹
```typescript
// é©åˆ‡ãªèªè¨¼å‡¦ç†
async function login(email: string, password: string): Promise<User> {
  if (!email || !password) throw new Error('Email and password are required');
  
  try {
    const result = await signInWithEmailAndPassword(auth, email, password);
    return result.user;
  } catch (error) {
    console.error('Login error:', error);
    throw error;
  }
}

// é©åˆ‡ãªèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
function isAuthenticated(): boolean {
  return !!auth.currentUser;
}
```

### Storageã®æ›¸ãæ–¹

#### âŒ æ‚ªã„ä¾‹
```typescript
// ä¸é©åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
async function uploadFile(file: File, path: string) {
  try {
    const storageRef = ref(storage, path);
    const snapshot = await uploadBytes(storageRef, file);
    const downloadURL = await getDownloadURL(snapshot.ref);
    return downloadURL;
  } catch (error) {
    console.error('Upload error:', error);
    return null;
  }
}
```

#### âœ… è‰¯ã„ä¾‹
```typescript
// é©åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
async function uploadFile(file: File, path: string): Promise<string> {
  if (!file || !path) throw new Error('File and path are required');
  
  try {
    const storageRef = ref(storage, path);
    const snapshot = await uploadBytes(storageRef, file);
    return await getDownloadURL(snapshot.ref);
  } catch (error) {
    console.error('Upload error:', error);
    throw error;
  }
}
```

## ğŸ”§ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
```typescript
// çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
async function handleFirebaseError<T>(
  operation: () => Promise<T>
): Promise<T> {
  try {
    return await operation();
  } catch (error) {
    console.error('Firebase operation failed:', error);
    throw error;
  }
}

// ä½¿ç”¨ä¾‹
const getUsers = () => handleFirebaseError(async () => {
  const snapshot = await getDocs(collection(db, 'users'));
  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
});
```

### 2. å‹å®‰å…¨æ€§ã®ç¢ºä¿
```typescript
// é©åˆ‡ãªå‹å®šç¾©
interface User {
  id: string;
  name: string;
  email: string;
  isActive: boolean;
  createdAt: Timestamp;
}

// å‹å®‰å…¨ãªã‚¯ã‚¨ãƒª
async function getUserById(id: string): Promise<User | null> {
  try {
    const docRef = doc(db, 'users', id);
    const docSnap = await getDoc(docRef);
    
    if (docSnap.exists()) {
      return { id: docSnap.id, ...docSnap.data() } as User;
    }
    return null;
  } catch (error) {
    console.error('Error getting user:', error);
    throw error;
  }
}
```

### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†
```typescript
// é©åˆ‡ãªãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†
function useUsers() {
  const users = ref<User[]>([]);
  const loading = ref(false);
  const error = ref<string | null>(null);
  
  let unsubscribe: (() => void) | null = null;
  
  const startListening = () => {
    if (unsubscribe) return;
    
    loading.value = true;
    error.value = null;
    
    const q = query(collection(db, 'users'), where('isActive', '==', true));
    
    unsubscribe = onSnapshot(q, 
      (snapshot) => {
        users.value = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        } as User));
        loading.value = false;
      },
      (err) => {
        error.value = err.message;
        loading.value = false;
      }
    );
  };
  
  const stopListening = () => {
    if (unsubscribe) {
      unsubscribe();
      unsubscribe = null;
    }
  };
  
  onUnmounted(() => {
    stopListening();
  });
  
  return { users, loading, error, startListening, stopListening };
}
```

### 4. ãƒãƒƒãƒæ“ä½œã®æ´»ç”¨
```typescript
// é©åˆ‡ãªãƒãƒƒãƒæ“ä½œ
async function createMultipleUsers(users: Omit<User, 'id'>[]): Promise<void> {
  if (!users.length) return;
  
  const batch = writeBatch(db);
  
  users.forEach(userData => {
    const docRef = doc(collection(db, 'users'));
    batch.set(docRef, userData);
  });
  
  try {
    await batch.commit();
  } catch (error) {
    console.error('Error creating users:', error);
    throw error;
  }
}
```

## ğŸš« é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ä¸é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
```javascript
// âŒ é¿ã‘ã‚‹ - éåº¦ã«ç·©ã„ãƒ«ãƒ¼ãƒ«
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

// âœ… æ¨å¥¨ - é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

### 2. ä¸é©åˆ‡ãªã‚¯ã‚¨ãƒª
```typescript
// âŒ é¿ã‘ã‚‹ - éåŠ¹ç‡ãªã‚¯ã‚¨ãƒª
async function getUsers() {
  const snapshot = await getDocs(collection(db, 'users'));
  return snapshot.docs
    .map(doc => doc.data())
    .filter(user => user.isActive);
}

// âœ… æ¨å¥¨ - åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒª
async function getActiveUsers() {
  const q = query(
    collection(db, 'users'),
    where('isActive', '==', true)
  );
  const snapshot = await getDocs(q);
  return snapshot.docs.map(doc => doc.data());
}
```

### 3. ä¸é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
// âŒ é¿ã‘ã‚‹
async function getUser(id: string) {
  try {
    const doc = await getDoc(doc(db, 'users', id));
    return doc.data();
  } catch (error) {
    console.error('Error:', error);
    return null;
  }
}

// âœ… æ¨å¥¨
async function getUser(id: string): Promise<User | null> {
  if (!id) throw new Error('User ID is required');
  
  try {
    const docRef = doc(db, 'users', id);
    const docSnap = await getDoc(docRef);
    
    if (docSnap.exists()) {
      return { id: docSnap.id, ...docSnap.data() } as User;
    }
    return null;
  } catch (error) {
    console.error('Error getting user:', error);
    throw error;
  }
}
```

### 4. ä¸é©åˆ‡ãªèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
```typescript
// âŒ é¿ã‘ã‚‹
function isLoggedIn() {
  return auth.currentUser !== null;
}

// âœ… æ¨å¥¨
function isAuthenticated(): boolean {
  return !!auth.currentUser;
}

// ã‚ˆã‚Šè©³ç´°ãªèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
function getAuthState(): 'loading' | 'authenticated' | 'unauthenticated' {
  if (auth.currentUser) return 'authenticated';
  if (auth.currentUser === null) return 'unauthenticated';
  return 'loading';
}
```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] èªè¨¼çŠ¶æ…‹ã®ç¢ºèªãŒé©åˆ‡
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
- [ ] å‹å®‰å…¨æ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¯ã‚¨ãƒªãŒåŠ¹ç‡çš„
- [ ] ãƒªã‚¹ãƒŠãƒ¼ãŒé©åˆ‡ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒƒãƒæ“ä½œãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’æœ€é©åŒ–
- [ ] ã‚¯ã‚¨ãƒªã‚’åŠ¹ç‡åŒ–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’çµ±ä¸€
- [ ] å‹å®šç¾©ã‚’æ”¹å–„
- [ ] ãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†ã‚’æ”¹å–„

## ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
3. **å‹å®‰å…¨æ€§**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
5. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: é©åˆ‡ãªãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†
6. **ãƒãƒƒãƒæ“ä½œ**: åŠ¹ç‡çš„ãªãƒãƒƒãƒæ“ä½œã®æ´»ç”¨

## ğŸ’¡ å®Ÿè£…ã®ãƒ’ãƒ³ãƒˆ

### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®è¨­è¨ˆ
```javascript
// é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã¯èª­ã¿å–ã‚Šå¯èƒ½
    match /public/{document=**} {
      allow read: if true;
    }
  }
}
```

### 2. åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªã®ä½œæˆ
```typescript
// é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½¿ç”¨
const getRecentPosts = async (limit: number = 10) => {
  const q = query(
    collection(db, 'posts'),
    where('published', '==', true),
    orderBy('createdAt', 'desc'),
    limit(limit)
  );
  
  const snapshot = await getDocs(q);
  return snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));
};
```

### 3. é©åˆ‡ãªãƒªã‚¹ãƒŠãƒ¼ã®ç®¡ç†
```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ãƒªã‚¹ãƒŠãƒ¼ç®¡ç†
export function useRealtimeData<T>(
  collectionName: string,
  queryConstraints: QueryConstraint[] = []
) {
  const data = ref<T[]>([]);
  const loading = ref(false);
  const error = ref<string | null>(null);
  
  let unsubscribe: (() => void) | null = null;
  
  const startListening = () => {
    if (unsubscribe) return;
    
    loading.value = true;
    const q = query(collection(db, collectionName), ...queryConstraints);
    
    unsubscribe = onSnapshot(q, 
      (snapshot) => {
        data.value = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        } as T));
        loading.value = false;
      },
      (err) => {
        error.value = err.message;
        loading.value = false;
      }
    );
  };
  
  const stopListening = () => {
    if (unsubscribe) {
      unsubscribe();
      unsubscribe = null;
    }
  };
  
  onUnmounted(() => {
    stopListening();
  });
  
  return { data, loading, error, startListening, stopListening };
}
```

ã“ã®Firebaseã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã«å¾“ã†ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ã‚¢ã§åŠ¹ç‡çš„ãªFirebaseã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚